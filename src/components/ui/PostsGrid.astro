---
import type { CollectionEntry } from "astro:content";
import PostCard from "./PostCard.astro";

interface Props {
  posts: CollectionEntry<"writings">[];
  class?: string;
  showLoadMore?: boolean;
  totalPosts?: number;
  initialPostsCount?: number;
}

const {
  posts,
  class: className = "",
  showLoadMore = false,
  totalPosts = 0,
  initialPostsCount = 0,
} = Astro.props;

const hasMorePosts = showLoadMore && totalPosts > initialPostsCount;
const remainingPosts = totalPosts - initialPostsCount;
---

<div class:list={[
  "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full",
  className
]}>
  {posts.map((post) => <PostCard post={post} class="w-full" />)}
</div>

{
  showLoadMore && hasMorePosts && (
    <div class="text-center mt-8 py-8">
      <button 
        id="load-more" 
        class="inline-block bg-blue-600 text-white border-none py-3 px-6 rounded-lg text-base font-medium cursor-pointer transition-all duration-200 shadow-sm hover:bg-blue-700 hover:-translate-y-0.5 hover:shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-sm"
      >
        Load More Writings ({remainingPosts} remaining)
      </button>
    </div>
  )
}

<script>
  // Lazy load more posts for better performance
  const loadMoreBtn = document.getElementById("load-more") as HTMLButtonElement;
  const postsGrid = document.querySelector(".posts-grid");

  if (loadMoreBtn && postsGrid) {
    loadMoreBtn.addEventListener("click", async () => {
      loadMoreBtn.textContent = "Loading...";
      loadMoreBtn.disabled = true;

      // Simulate loading delay for better UX
      await new Promise((resolve) => setTimeout(resolve, 300));

      // In a real implementation, you'd fetch more posts from an API
      // For now, we'll just hide the button
      loadMoreBtn.style.display = "none";

      // You could implement actual pagination here
      // const response = await fetch('/api/posts?page=2');
      // const morePosts = await response.json();
      // Render more posts...
    });
  }
</script>
